{"ast":null,"code":"import{useState}from'react';import{useForm}from'react-hook-form';import{yupResolver}from'@hookform/resolvers/yup';import{loginSchema}from'../utils/schema';import{useNavigate}from'react-router-dom';import{useAuth}from'../context/AuthContext';import{showError,showSuccess}from'../utils/toast';import{loginUser}from'../services/login';import Navbar from\"../component/Navbar\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const LoginForm=()=>{var _errors$email,_errors$password;const{setUser}=useAuth();const[serverError,setServerError]=useState('');const navigate=useNavigate();const{register,handleSubmit,formState:{errors}}=useForm({resolver:yupResolver(loginSchema)});//ログイン情報を送信\nconst onSubmit=async data=>{try{console.log(\"送信データ\",data);setServerError(\"\");const res=await loginUser(data);if(!res||!res.user){throw new Error(\"レスポンスにユーザーデータが含まれていません\");}const user=res.user;console.log(\"ログインデータ\",res);setUser(user);navigate(\"/\");showSuccess(`おかえりなさい！ ${user.user}さん`);}catch(error){var _error$response,_error$response$data;console.log('キャッチしたエラー',error);if(error.response){console.log('レスポンスデータ',error.response.data);}const message=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"ログインに失敗しました\";setServerError(message);}};const onError=errors=>console.log(errors);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center min-h-screen bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-xs\",children:[/*#__PURE__*/_jsxs(\"form\",{className:\"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4\",onSubmit:handleSubmit(onSubmit,onError),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[serverError&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-xs italic\",children:serverError}),/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"username\",children:\"\\u30E1\\u30FC\\u30EB\\u30A2\\u30C9\\u30EC\\u30B9\"}),/*#__PURE__*/_jsx(\"input\",{className:`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${errors.email||serverError?'border-red-500':''}`,id:\"username\",type:\"text\",placeholder:\"\\u30E6\\u30FC\\u30B6\\u30FC\\u540D\",...register(\"email\")}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-xs italic\",children:(_errors$email=errors.email)===null||_errors$email===void 0?void 0:_errors$email.message})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-gray-700 text-sm font-bold mb-2\",htmlFor:\"password\",children:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\"}),/*#__PURE__*/_jsx(\"input\",{className:`shadow appearance-none border  rounded w-full py-2 px-3 text-gray-700  leading-tight focus:outline-none focus:shadow-outline ${errors.password||serverError?'border-red-500':''}`,id:\"password\",type:\"password\",placeholder:\"\\u30D1\\u30B9\\u30EF\\u30FC\\u30C9\",...register(\"password\")}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-xs italic\",children:(_errors$password=errors.password)===null||_errors$password===void 0?void 0:_errors$password.message})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"button\",{className:\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\",type:\"submit\",children:\"\\u30ED\\u30B0\\u30A4\\u30F3\"})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 text-xs\",children:\"\\xA92020 Acme Corp. All rights reserved.\"})]})})]});};export default LoginForm;","map":{"version":3,"names":["useState","useForm","yupResolver","loginSchema","useNavigate","useAuth","showError","showSuccess","loginUser","Navbar","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","LoginForm","_errors$email","_errors$password","setUser","serverError","setServerError","navigate","register","handleSubmit","formState","errors","resolver","onSubmit","data","console","log","res","user","Error","error","_error$response","_error$response$data","response","message","onError","children","className","htmlFor","email","id","type","placeholder","password"],"sources":["C:/Users/hinan/todo-app/client/src/page/LoginForm.jsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { yupResolver } from '@hookform/resolvers/yup';\r\nimport { loginSchema } from '../utils/schema';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport {showError, showSuccess} from '../utils/toast';\r\nimport { loginUser } from '../services/login';\r\nimport Navbar from \"../component/Navbar\";\r\n\r\n\r\nconst  LoginForm = () => {\r\n  const { setUser } = useAuth();\r\n  const [serverError, setServerError] = useState('');\r\n\r\n  const navigate = useNavigate();\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    formState: { errors },\r\n  } = useForm({ resolver: yupResolver(loginSchema) });\r\n\r\n  //ログイン情報を送信\r\n  const onSubmit = async (data) => {\r\n    try {\r\n      console.log(\"送信データ\", data);\r\n      setServerError(\"\")\r\n      const res = await loginUser(data);\r\n      if (!res || !res.user) {\r\n        throw new Error(\"レスポンスにユーザーデータが含まれていません\");\r\n      }\r\n      const user = res.user;\r\n      console.log(\"ログインデータ\", res);\r\n      setUser(user);\r\n      navigate(\"/\")\r\n      showSuccess(`おかえりなさい！ ${user.user}さん`)\r\n\r\n    } catch (error) {\r\n        console.log('キャッチしたエラー', error);\r\n    if (error.response) {\r\n      console.log('レスポンスデータ', error.response.data);\r\n    }\r\n        const message = error.response?.data?.message || \"ログインに失敗しました\";\r\n        setServerError(message);\r\n    }\r\n  };\r\n\r\n const onError = (errors) => console.log(errors);\r\n  return (\r\n    <>\r\n    <Navbar />\r\n    <div className=\"flex items-center justify-center min-h-screen bg-gray-100\">\r\n    <div className=\"w-full max-w-xs\">\r\n      <form className=\"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4\" onSubmit={handleSubmit(onSubmit,onError)}>\r\n        <div className=\"mb-4\">\r\n          {serverError && <p className=\"text-red-500 text-xs italic\">{serverError}</p>}\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"username\">\r\n            メールアドレス\r\n          </label>\r\n          <input className={`shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline ${errors.email || serverError ? 'border-red-500' : ''}`} id=\"username\" type=\"text\" placeholder=\"ユーザー名\"\r\n            {...register(\"email\")}\r\n            />\r\n            <p className=\"text-red-500 text-xs italic\">{errors.email?.message}</p>\r\n        </div>\r\n        <div className=\"mb-6\">\r\n          <label className=\"block text-gray-700 text-sm font-bold mb-2\" htmlFor=\"password\">\r\n            パスワード\r\n          </label>\r\n          <input className={`shadow appearance-none border  rounded w-full py-2 px-3 text-gray-700  leading-tight focus:outline-none focus:shadow-outline ${errors.password || serverError ? 'border-red-500' : ''}`}  id=\"password\" type=\"password\" placeholder=\"パスワード\"\r\n            {...register(\"password\")}\r\n            />\r\n            <p className=\"text-red-500 text-xs italic\">{errors.password?.message}</p>\r\n        </div>\r\n        <div className=\"flex justify-end\">\r\n          <button className=\"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline\" type=\"submit\">\r\n            ログイン\r\n          </button>\r\n        </div>\r\n      </form>\r\n      <p className=\"text-center text-gray-500 text-xs\">\r\n        &copy;2020 Acme Corp. All rights reserved.\r\n      </p>\r\n    </div>\r\n    </div>\r\n  </>   \r\n  );\r\n};\r\n\r\nexport default LoginForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}