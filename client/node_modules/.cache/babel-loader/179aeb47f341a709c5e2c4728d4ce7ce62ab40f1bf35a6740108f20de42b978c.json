{"ast":null,"code":"import{useState,useEffect,useRef}from\"react\";// import CryptoJS from \"crypto-js\";\nimport React from\"react\";import TaskInput from\"./TaskInput\";import TaskList from\"./TaskList\";// import { useTasks } from \"./hooks/useTasks\"; \nimport{TaskContext}from\"./context/TaskContext\";import{useCategories}from\"./hooks/useCategories\";import CategoryInput from\"./CategoryInput\";import{useContext}from\"react\";import TaskListWrapper from\"./TaskListWrapper\";// const SECRET_KEY = process.env.REACT_APP_SECRET_KEY;\nimport Calendar from'react-calendar';import'react-calendar/dist/Calendar.css';import CalendarTodo from\"./Calender\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function TodoApp(){const{state,dispatch}=useContext(TaskContext);const[tasks,setTasks]=useState([]);// const { tasks, editText ,dueDate ,isLoading,categoryFilter} = state;\nconst{editText,dueDate,isLoading,categoryFilter}=state;const isFirstRender=useRef(true);const[task,setTask]=useState(\"\");const[priority,setPriority]=useState(2);const[selectedDate,setSelectedDate]=useState(new Date());const{categories,setCategories,selectedCategory,setSelectedCategory,newCategory,setNewCategory,addCategory}=useCategories(tasks,updatedTasks=>dispatch({type:\"INIT_TASKS\",payload:updatedTasks}));const handleAddTask=(text,priority,category,dueDate)=>{console.log(\"handleAddTask:priority\",priority);const value=Number(priority);console.log(\"選択された優先度:\",value);dispatch({type:\"ADD_TASK\",payload:{text,priority:value,category,dueDate}});setTask(\"\");setPriority(2);setSelectedCategory(categories[0]||\"\");dispatch({type:\"SET_DUE_DATE\",payload:\"\"});};useEffect(()=>{if(isFirstRender.current)return;try{localStorage.setItem(\"categories\",JSON.stringify(categories));}catch(error){console.error(\"カテゴリ保存エラー:\",error);}},[categories]);const removeCategory=categoryToRemove=>{if(categoryToRemove===\"未分類\")return;const updatedCategories=categories.filter(c=>c!==categoryToRemove);const updatedTasks=tasks.map(task=>task.category===categoryToRemove?{...task,category:\"未分類\"}:task);if(!updatedCategories.includes(\"未分類\")){updatedCategories.push(\"未分類\");}setCategories(updatedCategories);dispatch({type:\"INIT_TASKS\",payload:updatedTasks});};const handleCategoryFilterChange=category=>{const updatedFilter=categoryFilter.includes(category)?categoryFilter.filter(cat=>cat!==category):[...categoryFilter,category];console.log(\"新しいカテゴリフィルター,handleCategoryFilterChange:\",updatedFilter);dispatch({type:\"SET_CATEGORY_FILTER\",payload:updatedFilter});};const tasksForSelectedDate=tasks.filter(task=>task.dueDate&&new Date(task.dueDate).toDateString()===selectedDate.toDateString());useEffect(()=>{fetch('http://localhost:3000/api/tasks').then(res=>res.json()).then(data=>setTasks(data));},[]);//TASKSの中身\nuseEffect(()=>{console.log(\"タスク更新:\",tasks);},[tasks]);return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 max-w-md mx-auto bg-white shadow rounded-lg\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-xl font-bold mb-4\",children:\"ToDo \\u30A2\\u30D7\\u30EA\"}),isLoading?/*#__PURE__*/_jsx(\"p\",{children:\"\\u8AAD\\u307F\\u8FBC\\u307F\\u4E2D...\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"my-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold mb-2\",children:\"\\uD83D\\uDCC5 \\u30AB\\u30EC\\u30F3\\u30C0\\u30FC\\u304B\\u3089\\u65E5\\u4ED8\\u3092\\u9078\\u629E\"}),/*#__PURE__*/_jsx(CalendarTodo,{})]}),/*#__PURE__*/_jsx(TaskInput,{task:task,setTask:setTask,priority:priority,handlePriorityChange:e=>setPriority(Number(e.target.value)),setPriority:setPriority,selectedCategory:selectedCategory,setSelectedCategory:setSelectedCategory,categories:categories,addTask:handleAddTask,dueDate:dueDate,setDueDate:date=>dispatch({type:\"SET_DUE_DATE\",payload:date}),handleCheckboxChange:handleCategoryFilterChange,categoryFilter:categoryFilter}),/*#__PURE__*/_jsx(TaskListWrapper,{tasks:tasksForSelectedDate,categories:categories,editText:editText,dueDate:dueDate,removeCategory:removeCategory}),/*#__PURE__*/_jsx(CategoryInput,{newCategory:newCategory,setNewCategory:setNewCategory,addCategory:addCategory})]})]});}","map":{"version":3,"names":["useState","useEffect","useRef","React","TaskInput","TaskList","TaskContext","useCategories","CategoryInput","useContext","TaskListWrapper","Calendar","CalendarTodo","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TodoApp","state","dispatch","tasks","setTasks","editText","dueDate","isLoading","categoryFilter","isFirstRender","task","setTask","priority","setPriority","selectedDate","setSelectedDate","Date","categories","setCategories","selectedCategory","setSelectedCategory","newCategory","setNewCategory","addCategory","updatedTasks","type","payload","handleAddTask","text","category","console","log","value","Number","current","localStorage","setItem","JSON","stringify","error","removeCategory","categoryToRemove","updatedCategories","filter","c","map","includes","push","handleCategoryFilterChange","updatedFilter","cat","tasksForSelectedDate","toDateString","fetch","then","res","json","data","className","children","handlePriorityChange","e","target","addTask","setDueDate","date","handleCheckboxChange"],"sources":["C:/Users/hinan/todo-app/src/client/src/TodoApp.js"],"sourcesContent":["\r\nimport { useState, useEffect,useRef } from \"react\";\r\n// import CryptoJS from \"crypto-js\";\r\nimport React from \"react\";\r\nimport TaskInput from \"./TaskInput\";\r\nimport TaskList from \"./TaskList\";\r\n// import { useTasks } from \"./hooks/useTasks\"; \r\nimport { TaskContext } from \"./context/TaskContext\";\r\nimport { useCategories } from \"./hooks/useCategories\"; \r\nimport CategoryInput from \"./CategoryInput\";\r\nimport { useContext } from \"react\"; \r\nimport TaskListWrapper from \"./TaskListWrapper\";\r\n// const SECRET_KEY = process.env.REACT_APP_SECRET_KEY;\r\nimport Calendar from 'react-calendar';\r\nimport 'react-calendar/dist/Calendar.css';\r\nimport CalendarTodo from \"./Calender\";\r\n\r\n\r\nexport default function TodoApp() {\r\n  const { state, dispatch } = useContext(TaskContext);\r\n  const [tasks, setTasks] = useState([]);\r\n \r\n  // const { tasks, editText ,dueDate ,isLoading,categoryFilter} = state;\r\n  const {  editText ,dueDate ,isLoading,categoryFilter} = state;\r\n\r\n  const isFirstRender = useRef(true);\r\n  const [task, setTask] = useState(\"\");\r\n  const [priority, setPriority] = useState(2);\r\n  const [selectedDate, setSelectedDate] = useState(new Date());\r\n\r\n  const{\r\n    categories,\r\n    setCategories,\r\n    selectedCategory,\r\n    setSelectedCategory,\r\n    newCategory,\r\n    setNewCategory,\r\n    addCategory\r\n  }=useCategories(tasks, (updatedTasks) =>\r\n    dispatch({ type: \"INIT_TASKS\", payload: updatedTasks })\r\n  );\r\n\r\n  \r\n  const handleAddTask = (text, priority, category, dueDate) => {\r\n    console.log(\"handleAddTask:priority\",priority)\r\n    const value = Number(priority);\r\n    console.log(\"選択された優先度:\", value);\r\n\r\n    dispatch({\r\n      type: \"ADD_TASK\",\r\n      payload: { text, priority:value, category, dueDate },\r\n    });\r\n    setTask(\"\");\r\n    setPriority(2);\r\n    setSelectedCategory(categories[0] || \"\");\r\n    dispatch({ type: \"SET_DUE_DATE\", payload: \"\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isFirstRender.current) return; \r\n    \r\n    try {\r\n      localStorage.setItem(\"categories\", JSON.stringify(categories));\r\n    } catch (error) {\r\n      console.error(\"カテゴリ保存エラー:\", error);\r\n    }\r\n  }, [categories]);\r\n\r\n  const removeCategory = (categoryToRemove) => {\r\n    if (categoryToRemove === \"未分類\") return;\r\n  \r\n    const updatedCategories = categories.filter((c) => c !== categoryToRemove);\r\n    const updatedTasks = tasks.map(task =>\r\n      task.category === categoryToRemove ? { ...task, category: \"未分類\" } : task\r\n    );\r\n  \r\n    if (!updatedCategories.includes(\"未分類\")) {\r\n      updatedCategories.push(\"未分類\");\r\n    }\r\n  \r\n    setCategories(updatedCategories);\r\n    dispatch({ type: \"INIT_TASKS\", payload: updatedTasks });\r\n  };\r\n\r\n  const handleCategoryFilterChange = (category) => {\r\n    \r\n    const updatedFilter = categoryFilter.includes(category)\r\n      ? categoryFilter.filter((cat) => cat !== category) \r\n      : [...categoryFilter, category]; \r\n      console.log(\"新しいカテゴリフィルター,handleCategoryFilterChange:\", updatedFilter);\r\n    dispatch({ type: \"SET_CATEGORY_FILTER\", payload: updatedFilter });\r\n\r\n  };\r\n\r\n  const tasksForSelectedDate = tasks.filter(\r\n    (task) =>\r\n      task.dueDate &&\r\n      new Date(task.dueDate).toDateString() === selectedDate.toDateString()\r\n  );\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    fetch('http://localhost:3000/api/tasks')\r\n      .then(res => res.json())\r\n      .then(data => setTasks(data));\r\n  }, []);\r\n\r\n\r\n  //TASKSの中身\r\n  useEffect(() => {\r\n    console.log(\"タスク更新:\", tasks);\r\n  }, [tasks]);\r\n  \r\n  return (\r\n\r\n    <div className=\"p-4 max-w-md mx-auto bg-white shadow rounded-lg\">\r\n      <h1 className=\"text-xl font-bold mb-4\">ToDo アプリ</h1>\r\n\r\n      {isLoading ? (\r\n      <p>読み込み中...</p>\r\n    ) : (\r\n      <>\r\n      <div className=\"my-4\">\r\n        <h2 className=\"text-lg font-semibold mb-2\">📅 カレンダーから日付を選択</h2>\r\n        <CalendarTodo />\r\n      </div>\r\n      <TaskInput\r\n        task={task}\r\n        setTask={setTask}\r\n        priority={priority}\r\n        handlePriorityChange={(e) => setPriority(Number(e.target.value))} \r\n        setPriority={setPriority}\r\n        selectedCategory={selectedCategory}\r\n        setSelectedCategory={setSelectedCategory}\r\n        categories={categories}\r\n        addTask={handleAddTask}\r\n        dueDate = {dueDate}\r\n        setDueDate={(date) => dispatch({ type: \"SET_DUE_DATE\", payload: date })}\r\n        handleCheckboxChange={handleCategoryFilterChange}\r\n        categoryFilter={categoryFilter}\r\n      />\r\n\r\n      <TaskListWrapper\r\n      tasks={tasksForSelectedDate}\r\n          categories={categories}\r\n          editText={editText}\r\n          dueDate={dueDate}\r\n          removeCategory={removeCategory}\r\n      />\r\n\r\n      <CategoryInput\r\n        newCategory = {newCategory}\r\n        setNewCategory = {setNewCategory}\r\n        addCategory = {addCategory}\r\n      />\r\n      </>\r\n      )}\r\n  </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}